<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Squircle Aimbot Pop Game</title>
    <style>
      /* Global Styles */
      body {
        margin: 0;
        overflow: hidden;
        background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        font-family: sans-serif;
        user-select: none;
        position: relative;
      }
      #gameArea {
        position: relative;
        width: 100vw;
        height: 100vh;
      }
      /* Squircle Styles */
      .squircle {
        position: absolute;
        border-radius: 30%;
        transition: background-color 0.5s ease, transform 0.2s ease,
          opacity 0.2s ease;
        /* A smooth transition when its color or transform changes */
      }
      /* Highlighter element: outlines the currently selected squircle */
      #highlighter {
        position: absolute;
        border: 3px solid yellow;
        border-radius: 30%;
        pointer-events: none;
        transition: left 0.1s ease, top 0.1s ease, width 0.1s ease,
          height 0.1s ease;
      }
      /* Explosion letters for pop effect */
      .letter {
        position: absolute;
        font-weight: bold;
        color: #333;
        pointer-events: none;
        animation: explodeLetter 1s forwards ease-out;
      }
      @keyframes explodeLetter {
        from {
          opacity: 1;
          transform: translate(0, 0) rotate(0deg);
        }
        to {
          opacity: 0;
          transform: translate(var(--dx), var(--dy)) rotate(360deg);
        }
      }
      /* Vertical slider styling */
      #sliderContainer {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        z-index: 1000;
      }
      #colorSlider {
        -webkit-appearance: none;
        width: 200px; /* Length of the slider after rotation */
        transform: rotate(90deg);
        background: transparent;
      }
      #colorSlider::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        background: #333;
        border-radius: 50%;
        cursor: pointer;
      }
      #colorSlider:focus {
        outline: none;
      }
    </style>
  </head>
  <body>
    <div id="gameArea"></div>
    <!-- Highlighter element that follows the virtual cursor -->
    <div id="highlighter" style="display: none"></div>
    <div id="sliderContainer">
      <input type="range" id="colorSlider" min="0" max="360" value="200" />
    </div>
    <!-- Audio for pop sound effect -->
    <audio
      id="popSound"
      src="https://freesound.org/data/previews/341/341695_3248244-lq.mp3"
    ></audio>
    <script>
      // Global configuration variables
      let currentHue = 200; // initial hue from the slider
      const minSize = 40;
      const maxSize = 100;
      const gridSpacing = 80; // Denser grid spacing for more squircles
      const gameArea = document.getElementById("gameArea");
      const popSound = document.getElementById("popSound");
      popSound.volume = 0.5;

      const highlighter = document.getElementById("highlighter");
      let currentHighlighted = null;

      // Utility: random number between min and max
      function random(min, max) {
        return Math.random() * (max - min) + min;
      }

      // Compute lightness based on squircle size (larger = darker)
      function computeLightness(size) {
        const norm = (size - minSize) / (maxSize - minSize);
        return 90 - norm * 40; // lightness ranges from 90% to 50%
      }

      // Create a squircle element at (x, y) with a given size
      function createSquircle(x, y, size) {
        const squircle = document.createElement("div");
        squircle.className = "squircle";
        squircle.style.width = size + "px";
        squircle.style.height = size + "px";
        // Center the squircle at the provided (x, y)
        squircle.style.left = x - size / 2 + "px";
        squircle.style.top = y - size / 2 + "px";
        squircle.dataset.size = size;
        // Set accent color based on currentHue and size (larger squircles darker)
        const lightness = computeLightness(size);
        squircle.style.backgroundColor = `hsl(${currentHue}, 80%, ${lightness}%)`;
        gameArea.appendChild(squircle);
      }

      // Build a massive grid of squircles filling the viewport
      function createGrid() {
        // Clear previous squircles if any
        gameArea.innerHTML = "";
        // Re-add the highlighter element (always on top)
        gameArea.appendChild(highlighter);
        // Calculate columns and rows based on gridSpacing
        const cols = Math.floor(window.innerWidth / gridSpacing) + 1;
        const rows = Math.floor(window.innerHeight / gridSpacing) + 1;
        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            // Center positions for each grid cell
            const centerX = gridSpacing / 2 + col * gridSpacing;
            const centerY = gridSpacing / 2 + row * gridSpacing;
            const size = Math.floor(random(minSize, maxSize));
            createSquircle(centerX, centerY, size);
          }
        }
      }

      // When a squircle is popped, play sound and create explosion letters
      function popSquircle(squircle) {
        if (!squircle.classList.contains("popped")) {
          squircle.classList.add("popped");
          // Get the squircle's bounding rectangle and center coordinates
          const rect = squircle.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          const size = parseInt(squircle.dataset.size, 10);
          // Play pop sound
          popSound.currentTime = 0;
          popSound.play();
          // Create explosion letters (P, O, P) at the squircle's center
          createExplosionText(centerX, centerY, size);
          // Animate the squircle: scale up and fade out
          squircle.style.transform = "scale(1.5)";
          squircle.style.opacity = 0;
          // Remove the squircle after the animation finishes
          setTimeout(() => {
            squircle.remove();
          }, 200);
        }
      }

      // Create explosion letters that burst outward with rotation
      function createExplosionText(x, y, size) {
        const letters = [
          { char: "P", angle: -90 },
          { char: "O", angle: -90 + 120 },
          { char: "P", angle: -90 + 240 },
        ];
        letters.forEach((letterData) => {
          const letterElem = document.createElement("span");
          letterElem.className = "letter";
          letterElem.textContent = letterData.char;
          // Set font size relative to the squircle size
          const fontSize = Math.floor(size * 0.5);
          letterElem.style.fontSize = fontSize + "px";
          // Position the letter centered at the explosion origin
          letterElem.style.left = x - fontSize / 2 + "px";
          letterElem.style.top = y - fontSize / 2 + "px";
          // Determine explosion distance (random between 50 and 100px)
          const distance = random(50, 100);
          const rad = letterData.angle * (Math.PI / 180);
          const dx = Math.cos(rad) * distance;
          const dy = Math.sin(rad) * distance;
          letterElem.style.setProperty("--dx", dx + "px");
          letterElem.style.setProperty("--dy", dy + "px");
          gameArea.appendChild(letterElem);
          letterElem.addEventListener("animationend", () => {
            letterElem.remove();
          });
        });
      }

      // Update accent color of all squircles based on currentHue
      function updateSquircleColors() {
        const squircles = document.querySelectorAll(".squircle");
        squircles.forEach((s) => {
          const size = parseInt(s.dataset.size, 10);
          const lightness = computeLightness(size);
          s.style.backgroundColor = `hsl(${currentHue}, 80%, ${lightness}%)`;
        });
      }

      // Find the squircle closest to the given (x, y) and update the highlighter
      function updateHighlighter(x, y) {
        const squircles = document.querySelectorAll(".squircle");
        if (!squircles.length) {
          highlighter.style.display = "none";
          currentHighlighted = null;
          return;
        }
        let closest = null;
        let minDist = Infinity;
        squircles.forEach((s) => {
          const rect = s.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          const dx = centerX - x;
          const dy = centerY - y;
          const dist = dx * dx + dy * dy;
          if (dist < minDist) {
            minDist = dist;
            closest = s;
          }
        });
        if (closest) {
          currentHighlighted = closest;
          const rect = closest.getBoundingClientRect();
          // Position the highlighter exactly over the squircle
          highlighter.style.left = rect.left + "px";
          highlighter.style.top = rect.top + "px";
          highlighter.style.width = rect.width + "px";
          highlighter.style.height = rect.height + "px";
          highlighter.style.borderRadius = closest.style.borderRadius;
          highlighter.style.display = "block";
        }
      }

      // Global mousemove to update the highlighter's target
      document.addEventListener("mousemove", (e) => {
        updateHighlighter(e.clientX, e.clientY);
      });

      // Global click: pop the squircle currently highlighted, if any
      document.addEventListener("click", (e) => {
        if (currentHighlighted) {
          popSquircle(currentHighlighted);
        }
      });

      // Set up the color slider event to change hue
      const colorSlider = document.getElementById("colorSlider");
      colorSlider.addEventListener("input", (e) => {
        currentHue = e.target.value;
        updateSquircleColors();
      });

      // Rebuild the grid on window resize
      window.addEventListener("resize", createGrid);

      // Initial grid creation
      createGrid();
    </script>
  </body>
</html>
